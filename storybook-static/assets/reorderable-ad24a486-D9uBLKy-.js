import{i as R,a as x,b as T}from"./draggable-3c5539a5-C1SC_K6H.js";import{a as G}from"./raf-ac8923ee-Dje82vI4.js";var g;function w(b){return!!(b&&["internal","external"].includes(b.reorderable))}const I=300;class k{static createCursor(){const e=document.createElement("div");return e.classList.add("market-drag-cursor"),e}constructor({el:e,accepts:t,event:n,mode:a}){this.el=e,this.accepts=t,this.event=n,this.mode=a}isValidDrag(e,t,n){const{el:a,accepts:p}=this,l=t==null?void 0:t.closest('[reorderable="internal"], [reorderable="external"]'),r=n==null?void 0:n.closest('[reorderable="internal"], [reorderable="external"]');if(!R(e)||!w(l)||!w(r)||e.closest(p.join(","))!==e||a!==l&&a!==r)return!1;if(l!==r){const f=l.reorderable==="external"&&r.reorderable==="external",s=L(l,r).closest('[reorderable="internal"], [reorderable="external"]');if(!f&&!s)return!1}return!0}dragMove(e){var t,n;const{el:a,accepts:p,tableGroupExpandTimeout:l}=this,{y:r,el:f,source:s,target:c}=e.detail,{cursor:i}=g;if(!this.isValidDrag(f,s,c))return;if(clearTimeout(l),(t=i.parentElement)===null||t===void 0||t.classList.remove("market-drag-cursor-parent"),c===a){a.append(i),a.classList.add("market-drag-cursor-parent");return}const o=c.closest(p.join(","));if(o&&o!==f){if(x(o)){const u=[...o.children].find(h=>T(h)&&h.slot==="parent"),{top:m,height:d}=u.getBoundingClientRect();if(o.collapsible&&o.collapsed){const h=Math.round(m+d/3),v=Math.round(m+d*2/3);r<h?o.before(i):r>v?o.after(i):(u.after(i),[...o.children].filter(E=>(T(E)||x(E))&&!E.slot).length>0&&(this.tableGroupExpandTimeout=setTimeout(async()=>{await o.setCollapsed(!1),await G(),u.after(i)},I)))}else{const h=Math.round(m+d/2);r<h?o.before(i):u.after(i)}}else{const{top:u,height:m}=o.getBoundingClientRect(),d=Math.round(u+m/2);r<d?o.before(i):o.after(i)}(n=i.parentElement)===null||n===void 0||n.classList.add("market-drag-cursor-parent")}}dragLeave(){var e;const{tableGroupExpandTimeout:t}=this,{cursor:n}=g;(e=n.parentElement)===null||e===void 0||e.classList.remove("market-drag-cursor-parent"),n.remove(),clearTimeout(t)}dragEnd(e){const{el:t,accepts:n,event:a,tableGroupExpandTimeout:p}=this,{el:l,source:r}=e.detail,{cursor:f}=g;clearTimeout(p);const s=f.parentElement;if(!this.isValidDrag(l,r,s))return;const c=r==null?void 0:r.closest('[reorderable="internal"], [reorderable="external"]'),i=s==null?void 0:s.closest('[reorderable="internal"], [reorderable="external"]');if(c===i)return;e.stopImmediatePropagation();const u=D(t,n).indexOf(l),m=-1,{defaultPrevented:d}=a.emit({item:l,oldIndex:u,newIndex:m});d&&(e.preventDefault(),f.remove())}async dragDrop(e){const{el:t,accepts:n,event:a,mode:p,tableGroupExpandTimeout:l}=this,{el:r,source:f}=e.detail,{cursor:s}=g;clearTimeout(l);const c=s.parentElement;if(t!==c||!this.isValidDrag(r,f,c))return;if(e.stopImmediatePropagation(),c==null||c.classList.remove("market-drag-cursor-parent"),[s.previousElementSibling,s.nextElementSibling].includes(r)){s.remove();return}const i=D(c,n),o=i.indexOf(r),u=[...i];o>=0&&u.splice(o,1);const m=u.indexOf(s.previousElementSibling)+1;if(m===o){s.remove();return}const d=document.createElement("div");r.replaceWith(d),s.replaceWith(r),await new Promise(v=>r.addEventListener("marketDragComplete",v,{once:!0})),p==="framework"&&d.replaceWith(r);const{defaultPrevented:h}=a.emit({item:r,oldIndex:o,newIndex:m});h&&p==="default"&&d.replaceWith(r),d.remove()}destroy(){g.cursor.remove(),clearTimeout(this.tableGroupExpandTimeout),this.el=null,this.accepts=null,this.event=null,this.mode=null,this.tableGroupExpandTimeout=null}}g=k;k.cursor=g.createCursor();function D(b,e){const t=[],n=e.map(a=>`:scope > ${a}`);return b.querySelectorAll(n.join(",")).forEach(a=>{R(a)&&t.push(a)}),t}function L(b,e){let t=b;for(;t;){if(t.contains(e))return t;t=t.parentElement}return null}export{k as R};
