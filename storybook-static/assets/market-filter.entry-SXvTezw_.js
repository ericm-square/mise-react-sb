import{r as b,c as u,h as r,H as E,g as V}from"./preview-BLkU8-7b.js";import{c as S}from"./classnames-84eaa2b2-DUfJYZCM.js";import{g as n}from"./index-2dc281eb-DCayfYZh.js";import{M as w}from"./menu-48d7df69-CVnCCBlU.js";import{i as C}from"./utils-cc39d575-jvTINiUJ.js";import"./jsx-runtime-qGIIFXMu.js";import"./index-CDs2tPxN.js";import"./iframe-BYgjunmg.js";import"../sb-preview/runtime.js";import"./tslib.es6-pJfR_DrR.js";const F=":host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}:host{display:inline-block}.dropdown,.dropdown>.filter-button{width:100%}.date-popover{max-width:unset;max-height:unset}",x=F,P=class{constructor(e){b(this,e),this.marketFilterClosed=u(this,"marketFilterClosed",7),this.marketFilterOpened=u(this,"marketFilterOpened",7),this.marketFilterExpandedChanged=u(this,"marketFilterExpandedChanged",7),this.marketFilterValueDidChange=u(this,"marketFilterValueDidChange",7),this.name=void 0,this.disabled=void 0,this.focused=!1,this.size="medium",this.expanded=!1,this.dropdownInteraction=void 0,this.popoverPlacement="bottom-start",this.popoverStrategy="absolute",this.selectedDisplayValue=void 0}async getFilterType(){return Promise.resolve(this.filterType)}async setFocus(e=!0){return this.focused=await this.filterButtonEl.setFocus(e),Promise.resolve(this.focused)}handleListSelectionChange({detail:e}){var l;this.setDisplayValueFromListEvent(e);const t=e.prevSelectionValues.length>1?e.prevSelectionValues:e.prevSelectionValues[0],a=e.currentSelectionValues.length===0?null:e.currentSelectionValues.length===1?e.currentSelectionValues[0]:e.currentSelectionValues;this.rawValue=a,this.marketFilterValueDidChange.emit({name:this.name,prevValue:t||null,value:a}),!(!((l=this.listEl)===null||l===void 0)&&l.multiselect)&&!this.dropdownInteraction&&(this.expanded=!1)}handleDateRangeChange(e){const{startDate:l,endDate:t,prevStartDate:a,prevEndDate:s}=e.detail;this.setDisplayValueFromDateEvent(e),this.marketFilterValueDidChange.emit({name:this.name,prevValue:{startDate:a,endDate:s},value:{startDate:l,endDate:t}})}handleDropdownOpened(e){if(e.target!==this.el)return;const{defaultPrevented:l}=this.marketFilterExpandedChanged.emit(!0);if(l){e.preventDefault();return}if(this.marketFilterOpened.emit().defaultPrevented){e.preventDefault();return}this.dropdownInteraction||(this.expanded=!0)}handleDropdownClosed(e){if(e.target!==this.el)return;const{defaultPrevented:l}=this.marketFilterExpandedChanged.emit(!1);if(l){e.preventDefault();return}if(this.marketFilterClosed.emit().defaultPrevented){e.preventDefault();return}this.dropdownInteraction||(this.expanded=!1)}handleDefaultSlotChange(){this.datePickerEl=this.el.querySelector(n("market-date-picker")),this.listEl=this.el.querySelector(n("market-list")),this.datePickerEl?(this.filterType="date",this.setDisplayValueFromSlottedElement()):this.listEl&&(this.listEl.interactive||(this.listEl.interactive=!0),this.filterType="list",this.setDisplayValueFromSlottedElement())}initRowObservers(){const e=t=>{typeof this.rawValue=="string"&&t.value===this.rawValue&&(this.selectedDisplayValue=this.getTextContentOfRowWithValue(t.value))};this.el.querySelectorAll(`${n("market-list")} ${n("market-row")}`).forEach(t=>{new MutationObserver(()=>e(t)).observe(t,{characterData:!0,subtree:!0})})}getTextContentOfRowWithValue(e){const l=n("market-row"),t=this.listEl.querySelector(`${l}[value="${e}"] [slot="label"]`);return t==null?void 0:t.textContent}setDisplayValueFromSlottedElement(){const e=this.el.querySelector('[slot="display-value"]');if(!!e){this.selectedDisplayValue=e.textContent;return}if(this.listEl){if(!this.listEl.value){this.selectedDisplayValue=void 0;return}if(this.rawValue=this.listEl.value,this.listEl.multiselect){const t=(()=>{if(typeof this.listEl.value=="string")return this.listEl.value.split(",").length;if(Array.isArray(this.listEl.value))return this.listEl.value.length})();if(t>1){this.selectedDisplayValue=`${t}`;return}}this.selectedDisplayValue=this.getTextContentOfRowWithValue(this.listEl.value)}else this.datePickerEl&&(this.selectedDisplayValue=this.formatDate({startDate:this.datePickerEl.selectedStartDate,endDate:this.datePickerEl.selectedEndDate}))}formatDate({startDate:e,endDate:l}){var t,a;const s=e?new Date(e):void 0,i=l?new Date(l):void 0;if(!s&&!i)return"";const o=this.datePickerEl.locale,c=!!(s&&i&&s.getFullYear()===i.getFullYear()),h=(t=s==null?void 0:s.toLocaleDateString(o,c&&i?{day:"numeric",month:"numeric"}:{dateStyle:"short"}))!==null&&t!==void 0?t:"",d=(a=i==null?void 0:i.toLocaleDateString(o,{dateStyle:"short"}))!==null&&a!==void 0?a:"";return`${h}${d?`â€“${d}`:""}`}setDisplayValueFromDateEvent(e){var l,t,a,s;const{menuSelection:i}=e.detail;if(i===w.CUSTOM)this.selectedDisplayValue=this.formatDate(e.detail);else if(i){const o=(s=(a=(t=(l=this.datePickerEl)===null||l===void 0?void 0:l.shadowRoot)===null||t===void 0?void 0:t.querySelector(`${n("market-date-picker-menu")} slot[name="${i}"]`))===null||a===void 0?void 0:a.textContent)===null||s===void 0?void 0:s.trim();this.selectedDisplayValue=o}}setDisplayValueFromListEvent({currentSelectionValues:e,currentSelections:l}){const t=this.el.querySelector('[slot="display-value"]');if(!!t){this.selectedDisplayValue=t.textContent;return}if(!(e!=null&&e.length))this.selectedDisplayValue=void 0;else if(e.length>1)this.selectedDisplayValue=`${e.length}`;else{const s=l[0].querySelector('[slot="label"]');this.selectedDisplayValue=s.textContent}}connectedCallback(){this.initRowObservers(),this.handleDefaultSlotChange()}render(){var e;const{datePickerEl:l,disabled:t,dropdownInteraction:a,expanded:s,handleDefaultSlotChange:i,listEl:o,popoverPlacement:c,popoverStrategy:h,selectedDisplayValue:d,size:f}=this,m=(e=o==null?void 0:o.multiselect)!==null&&e!==void 0?e:!1,p=!!l,v=a??(p||m?"persistent":void 0),y=n("market-dropdown"),D=n("market-popover"),g=n("market-filter-button");return r(E,{key:"09f66a6254d2215f52daf49d69deaa0e57ce2515",class:"market-filter"},r(y,{key:"5c870320c435a0563886495335c11286081369f9",class:"dropdown",disabled:t,expanded:s,interaction:v,popoverPlacement:c,popoverStrategy:h},r(g,{key:"3ac658551583853c22f10ce64b5b377e2fc6b1f4",active:s,class:"filter-button",disabled:t,ref:k=>this.filterButtonEl=k,slot:"trigger",size:f},r("slot",{key:"a1cfe16df82eb14eaa74e534d49fba34a896ce2a",name:"label"}),!C(d)&&r("span",{key:"1825eac62b22b5ef0d0005bc8d87ee7c924de6c1",slot:"feedback"},r("slot",{key:"8bd97c2d210edb2d6de85cc1743eaa271d852c41",name:"display-value"},d))),r(D,{key:"913004e2a9a349dced495dafad95736e179b168e",class:S({"date-popover":p}),slot:"popover"},r("slot",{key:"1b700628da98c2329373b2857aafb420a9826364",onSlotchange:i.bind(this)}),r("slot",{key:"2a0fce27f89fbbbaca530881e3e3d436ef8654fc",name:"list",onSlotchange:i.bind(this)}))))}get el(){return V(this)}};P.style=x;export{P as market_filter};
