import{r,c as o,h as n,H as l,g as c}from"./preview-BLkU8-7b.js";import{c as s}from"./index-2c945920-BNEorLC5.js";import{D as d,A as h}from"./dialog-cb6265a8-baZCa5V1.js";import{g as m}from"./index-2dc281eb-DCayfYZh.js";import"./jsx-runtime-qGIIFXMu.js";import"./index-CDs2tPxN.js";import"./iframe-BYgjunmg.js";import"../sb-preview/runtime.js";import"./tslib.es6-pJfR_DrR.js";const g=`:host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}:host{position:absolute;display:grid;justify-items:center;width:100vw;height:100%;animation:var(--core-animation-enter-transition-moderate-speed-duration)
    market-fade-in
    forwards
    var(--core-animation-enter-transition-easing)}:host([hidden]){opacity:0%;animation-name:market-fade-out;animation-duration:var(--core-animation-exit-transition-moderate-speed-duration);animation-timing-function:var(--core-animation-exit-transition-easing)}:host>*{pointer-events:auto}:host(:not(.no-veil)){background-color:var(--core-surface-overlay-color);opacity:100%;pointer-events:auto}:host(.no-veil){pointer-events:none}@media screen and (min-width: 800px){::slotted(.market-modal-partial){align-self:center;margin:var(--modal-partial-vertical-screen-buffer-size) var(--modal-partial-horizontal-screen-buffer-size)}}::slotted(.market-dialog){align-self:center;width:calc(100% - (2 * var(--modal-dialog-horizontal-screen-buffer-size, 16px)))}`,u=g,k=class{constructor(t){r(this,t),this.marketContextContentsChanged=o(this,"marketContextContentsChanged",7),this.marketContextEmptied=o(this,"marketContextEmptied",7),this.currentDialog=void 0,this.noVeil=!1,this.hidden=!1,this.animationEnterDuration=s.CORE_ANIMATION_ENTER_TRANSITION_MODERATE_SPEED_DURATION,this.animationExitDuration=s.CORE_ANIMATION_EXIT_TRANSITION_MODERATE_SPEED_DURATION,this.stack=[],this.totalCount=0,this.dialogMeta={}}currentDialogWatcher(t){this.stack.push(t),this.stack=[...this.stack]}stackWatcher(t){t.forEach(e=>{this.dialogMeta[e.type].count+=1,this.totalCount+=1}),t.length===0&&(this.hidden=!0,setTimeout(()=>{this.marketContextEmptied.emit()},this.animationExitDuration)),this.setContextVeil()}doesStackContainDialogThatRequiresVeil(t){return Object.entries(d).filter(([,i])=>i.veil).map(([i])=>m(`market-${i}`)).includes(t.tagName.toLowerCase())}setContextVeil(){this.el.hasAttribute("no-veil")||this.stack.length===0||(this.noVeil=!this.stack.some(t=>this.doesStackContainDialogThatRequiresVeil(t.el)))}stackHasDialog(t){return this.stack.some(e=>e.el===t)}modalLoadedEventHandler(t){const e=t.detail.dialog,i=t.detail.type;if(e.parentElement!==this.el)return;if(this.stackHasDialog(e))return;const a=this.generateDialogID(i);e.dialogID=a,e.id=e.id||a,this.currentDialog={el:e,type:i,dialogID:e.dialogID,id:e.id,index:this.stack.length,indexOfType:this.dialogMeta[i].count+1},this.marketContextContentsChanged.emit({action:"marketNewDialogOpened",currentDialog:this.currentDialog,stack:this.stack})}dialogDismissedEventHandler(t){t.defaultPrevented||t.target.parentElement===this.el&&this.close(t.detail.dialog.dialogID)}generateDialogID(t){return`${t}-${this.dialogMeta[t].count+1}`}getDialogByID(t){return this.stack.find(e=>e.dialogID===t)}open(t){return this.stack.length===0&&(this.noVeil=!this.doesStackContainDialogThatRequiresVeil(t)),this.el.appendChild(t),Promise.resolve()}close(t){let e;const i=this.stack.indexOf(e);if(t?(e=this.stack.find(a=>a.dialogID===t),!e&&console.warn(`Tried to close dialog with data-dialog-id "${t}" but none were found`)):e=this.currentDialog,e){if(e.type==="dialog"&&e.el.persistent)return Promise.resolve();setTimeout(()=>{e.el.remove(),this.stack.splice(i,1),this.stack=[...this.stack],this.marketContextContentsChanged.emit({action:"marketDialogClosed",currentDialog:e,stack:this.stack})},e.el.animationExitDuration)}return Promise.resolve()}closeCurrent(){return this.close(),Promise.resolve()}connectedCallback(){h.forEach(t=>{this.dialogMeta[t]={count:0}})}render(){return n(l,{key:"2a0b56ee061c12442f50ceeaa8cb717817a0d1d5",class:`market-context ${this.noVeil?"no-veil":""}`},n("slot",{key:"12f97a955528ee801f1459cc9426f71b4a625025"}))}get el(){return c(this)}static get watchers(){return{currentDialog:["currentDialogWatcher"],stack:["stackWatcher"]}}};k.style=u;export{k as market_context};
