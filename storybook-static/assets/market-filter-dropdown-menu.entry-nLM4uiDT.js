import{r as u,h as r,F as g,H as w,g as k}from"./preview-BLkU8-7b.js";import{c as b}from"./classnames-84eaa2b2-DUfJYZCM.js";import{g as n}from"./index-2dc281eb-DCayfYZh.js";import"./jsx-runtime-qGIIFXMu.js";import"./index-CDs2tPxN.js";import"./iframe-BYgjunmg.js";import"../sb-preview/runtime.js";import"./tslib.es6-pJfR_DrR.js";const y=`:host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}::slotted([slot="filter-title"]){font-weight:var(--core-type-heading-20-weight);font-size:var(--core-type-heading-20-size);font-family:var(--core-type-heading-20-font-family);line-height:var(--core-type-heading-20-leading);letter-spacing:var(--core-type-heading-20-tracking);text-transform:var(--core-type-heading-20-case)}.overflow-filters{overflow:hidden;height:0}.popover{display:flex;flex-direction:column}.selection-header::part(heading){--filter-overflow-heading-margin-top-size:var(--core-metrics-spacing-200);margin-top:var(--filter-overflow-heading-margin-top-size)}.filter-options-container{--filter-overflow-filter-options-container-margin-top-size:var(--core-metrics-spacing-100);display:flex;flex:1;overflow-y:auto;width:calc(
      100% +
      var(--modal-popover-wide-viewport-padding-left-size) +
      var(--modal-popover-wide-viewport-padding-right-size)
    );margin:var(--filter-overflow-filter-options-container-margin-top-size)
    calc(var(--modal-popover-wide-viewport-padding-right-size) * -1)
    calc(var(--modal-popover-wide-viewport-padding-bottom-size) * -1)
    calc(var(--modal-popover-wide-viewport-padding-left-size) * -1);padding-left:var(--modal-popover-wide-viewport-padding-left-size)}.filter-options-container ::slotted(.market-list[slot="filter-options"]){width:calc(100% - var(--modal-popover-wide-viewport-padding-right-size))}.filter-options-container ::slotted(.market-list[slot="filter-options"])::after{content:"";display:block;width:100%;height:var(--core-metrics-spacing-100)}.filter-options-container ::slotted(.market-date-picker[slot="filter-options"]){width:auto;min-width:var(--date-picker-minimum-width);padding-right:var(--modal-popover-wide-viewport-padding-right-size)}.filter-options-container ::slotted(.market-date-picker[slot="filter-options"])::after{content:"";display:block;width:100%;height:var(--core-metrics-spacing-300)}.filter-options-container ::slotted(.market-date-picker[slot="filter-options"][display-menu]){height:calc(100%)}`,S=y,F=class{constructor(e){u(this,e),this.size="medium",this.filtersWithSelectedValue=void 0,this.hasSelectedFilter=void 0,this.isDropdownActive=void 0}handleDropdownOpened(e){e.target===this.el&&(this.deselectFilter(),this.isDropdownActive=!0)}handleDropdownClosed(e){e.target===this.el&&(this.isDropdownActive=!1)}handleHeaderNavigate(){this.deselectFilter()}deselectFilter(){this.hasSelectedFilter=!1}handleOverflowFiltersSlotChange(){this.filterEls=this.el.querySelector('[slot="overflow-filters"]').assignedNodes(),this.createRowsFromFilters(),this.calculateFiltersWithSelectedValue()}createRowsFromFilters(){var e,a,i,l;if(!(!((e=this.filterEls)===null||e===void 0)&&e.length)){(a=this.filterRowEls)===null||a===void 0||a.forEach(t=>{t.remove()});return}const p=((i=this.filterRowEls)!==null&&i!==void 0?i:[]).reduce((t,s)=>(t[s.value]=s,t),{}),d=new Set,h={};this.filterEls.forEach(t=>{var s;const o=t.name;d.add(o);const c=p[o];if(c)h[o]=c;else{const f=document.createElement(n("market-row"));f.variant="drill",f.interactive=!0,f.transient=!0,f.value=o,f.size=this.size,f.addEventListener("click",async()=>{await this.handleFilterSelection(f)}),h[o]=f}const v=(s=h[o])===null||s===void 0?void 0:s.querySelector("label");v==null||v.remove();const m=t.querySelector("label");m&&h[o].appendChild(m.cloneNode(!0)),t.disabled&&(h[o].disabled=!0),h[o].setAttribute("slot","filter-row")}),(l=this.filterRowEls)===null||l===void 0||l.forEach(t=>{d.has(t.value)||t.remove()}),this.filterRowEls=[...this.filterEls].map(({name:t})=>h[t]),this.filterRowEls.forEach(t=>{t.setAttribute("slot","filter-rows"),this.el.appendChild(t)})}async handleFilterSelection(e){var a,i,l;const p=e.value;this.hasSelectedFilter=!0;const d=this.filterEls.find(s=>s.name===p),t=d.querySelector("label").cloneNode(!0);switch(t.setAttribute("slot","filter-title"),(a=this.el.querySelector('[slot="filter-title"]'))===null||a===void 0||a.remove(),this.el.appendChild(t),await d.getFilterType()){case"date":{const o=d.querySelector(n("market-date-picker")).cloneNode(!0);o.setAttribute("slot","filter-options"),o.addEventListener("marketDateRangeChanged",c=>{this.handleDatePickerFilterSelection(c,d)}),(i=this.el.querySelector('[slot="filter-options"]'))===null||i===void 0||i.remove(),this.el.appendChild(o);break}case"list":{const s=d.querySelector(n("market-list")),o=s.multiselect,c=s.cloneNode(!0);c.setAttribute("slot","filter-options"),c.addEventListener("marketListSelectionsDidChange",v=>{this.handleListFilterSelection(v,d,o)}),c.setAttribute("interactive",""),s.multiselect&&t.setAttribute("multiselect",""),(l=this.el.querySelector('[slot="filter-options"]'))===null||l===void 0||l.remove(),this.el.appendChild(c);break}}}handleDatePickerFilterSelection(e,a){const{startDate:i,endDate:l}=e.detail,p=a.querySelector(n("market-date-picker"));p.selectedStartDate=i,p.selectedEndDate=l,this.calculateFiltersWithSelectedValue()}handleListFilterSelection(e,a,i){const{currentSelectionValues:l}=e.detail,p=a.querySelector(n("market-list"));p.value=l.join(","),i||this.deselectFilter(),this.calculateFiltersWithSelectedValue()}calculateFiltersWithSelectedValue(){this.filtersWithSelectedValue=[...this.filterEls||[]].reduce((e,a)=>{const i=a.querySelector(n("market-list"));if(i!=null&&i.value)return e+1;const l=a.querySelector(n("market-date-picker"));return l!=null&&l.selectedStartDate?e+1:e},0)}componentDidLoad(){this.handleOverflowFiltersSlotChange()}render(){const{filtersWithSelectedValue:e,handleOverflowFiltersSlotChange:a,hasSelectedFilter:i,isDropdownActive:l,size:p}=this,d=n("market-button"),h=n("market-dropdown"),t=n("market-filter-button"),s=n("market-header"),o=n("market-list"),c=n("market-popover"),v=n("market-accessory");return r(w,{key:"92e24d51066b6a17f2a8d3a63b4abba097b917cf",class:b("market-filter-dropdown-menu",{"show-options":i})},r(h,{key:"9ea7b8a3ff56de4066656d7be6af01235ae4adf8",interaction:"persistent",popoverPlacement:"bottom-end"},r(t,{key:"60cb46d8b7cbada44d86ce362f11cb420700845b",active:l,iconOnly:!0,size:p,slot:"trigger"},e&&r("span",{key:"61977bb6a6af7492269e4e2bfd0b4116824bdd0a",slot:"feedback"},e)),r(c,{key:"0829a84526a1635015904476453df8456a3fb5c9",class:"popover",slot:"popover"},i?r(g,null,r(s,{class:"selection-header"},r(d,{rank:"secondary",size:"small",slot:"navigation"},r(v,{slot:"icon"},r("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},r("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.29289 11.293C3.90237 11.6835 3.90237 12.3167 4.29289 12.7072L11.2929 19.7072L12.7071 18.293L7.41421 13.0001L19 13.0001V11.0001L7.41421 11.0001L12.7071 5.70718L11.2929 4.29297L4.29289 11.293Z"})))),r("slot",{name:"filter-title"})),r("div",{class:"filter-options-container"},r("slot",{name:"filter-options"}))):r(o,{class:"filter-list",interactive:!0},r("slot",{name:"filter-rows"})))),r("div",{key:"f9da8f965c60815ae37d2fb15f88645d1ab48b0d",class:"overflow-filters"},r("slot",{key:"54acf1c06f961d5e97091d7a6d1d835f84b70afd",name:"overflow-filters",onSlotchange:a.bind(this)})))}get el(){return k(this)}};F.style=S;export{F as market_filter_dropdown_menu};
