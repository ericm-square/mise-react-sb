import{r as b,h,H as E,g as S}from"./preview-BLkU8-7b.js";import{c as d}from"./index-2c945920-BNEorLC5.js";import{g as a}from"./index-2dc281eb-DCayfYZh.js";import{a as u}from"./raf-ac8923ee-Dje82vI4.js";import{t as I}from"./throttle-552e88ff-BILzQ6sF.js";import"./isObject-f305a0d7-CA5ssx5i.js";import"./jsx-runtime-qGIIFXMu.js";import"./index-CDs2tPxN.js";import"./iframe-BYgjunmg.js";import"../sb-preview/runtime.js";import"./tslib.es6-pJfR_DrR.js";import"./isSymbol-385885b1-CYoGKoqs.js";const F=':host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}:host{--filter-group-margin:var(--core-metrics-spacing-200);--filter-group-search-width:280px;display:flex;margin:var(--filter-group-margin)}.content{--filter-group-button-spacing:var(--core-metrics-spacing-100);display:flex;flex:1;flex-flow:row nowrap;gap:var(--filter-group-button-spacing, var(--core-metrics-spacing-100))}::slotted([slot="search"]){max-width:var(--filter-group-search-width)}::slotted([slot="search"]:not([compact])){min-width:var(--filter-group-search-width)}::slotted([slot="search"][focused]){flex:1 1 var(--filter-group-search-width)}@media (max-width: 599px){.content{justify-content:space-between}::slotted([slot="search"]){max-width:unset}::slotted([slot="search"][focused]){flex:1}::slotted([slot="filters"]){display:inline-flex;flex:1}}',g=F,p=3,v=8,_=50,y=8,A=16,R=class{constructor(t){b(this,t),this._isSearchActive=!1,this._willFocusOnFirstFilter=!1,this._willDelayDropdownOpen=!1,this._observers={},this.throttledHandleResize=I(this.handleResize.bind(this),A),this.maxVisibleFilters=3,this._sortedFilterEls={overflow:[],visible:[]}}maxVisibleFiltersWatcher(){this.handleResize()}marketInputSearchFocusHandler({detail:t}){this._isSearchActive=t}async marketInternalInputSearchCompactAnimationHandler(t){t.stopPropagation(),await this.handleResize(),await u(),this._willDelayDropdownOpen=t.detail==="animationstart"}marketDropdownOpenedHandler(t){this._willDelayDropdownOpen&&(this._willDelayDropdownOpen=!1,t.preventDefault(),setTimeout(async()=>{var e,i,r,s,o,l;await u(),await((r=(i=(e=this._dropdownMenuEl)===null||e===void 0?void 0:e.shadowRoot)===null||i===void 0?void 0:i.querySelector(a("market-dropdown")))===null||r===void 0?void 0:r.updateDropdownPosition()),(l=(o=(s=this._dropdownMenuEl)===null||s===void 0?void 0:s.shadowRoot)===null||o===void 0?void 0:o.querySelector(a("market-dropdown")))===null||l===void 0||l.openDropdown()},d.CORE_ANIMATION_EXIT_TRANSITION_FAST_SPEED_DURATION*1.25))}calculateOverflowButtonWidth(t){if(!(t!=null&&t.length))return 0;const e=t.reduce((o,l)=>{const n=l.querySelector(a("market-list"));if(n!=null&&n.value)return o+1;const c=l.querySelector(a("market-date-picker"));return c!=null&&c.selectedStartDate?o+1:o},0);if(e===0)return _;const i=document.createElement("canvas"),r=i.getContext("2d");t[0].size==="small"?r.font=`${d.CORE_TYPE_PARAGRAPH_20_SIZE}px ${d.CORE_TYPE_PARAGRAPH_20_FONT_FAMILY}`:r.font=`${d.CORE_TYPE_PARAGRAPH_30_SIZE}px ${d.CORE_TYPE_PARAGRAPH_30_FONT_FAMILY}`;const s=r.measureText(`${e}`).width;return i.remove(),_+y+s}getComputedWidth(t){return Number.parseFloat(window.getComputedStyle(t).width)}async findFilterCutoffIndex(){var t,e;if(((t=this.maxVisibleFilters)!==null&&t!==void 0?t:p)<=0)return 0;if((window==null?void 0:window.innerWidth)<=d.CORE_BREAKPOINT_NARROW_MAX_WIDTH)return 1;if(this._isSearchActive)return 0;const r=this.getComputedWidth(this.el),s=this._slottedInputSearchEl?this.getComputedWidth(this._slottedInputSearchEl)+v:0,o=document.createElement("div");o.style.width="auto",o.style.position="absolute",o.style.visibility="hidden",this.el.shadowRoot.appendChild(o);let l=0,n=0;for(const c of this._filterEls){if(l===((e=this.maxVisibleFilters)!==null&&e!==void 0?e:p))break;const w=l+1===this._filterEls.length?0:v+this.calculateOverflowButtonWidth(this._filterEls.slice(l)),f=c.cloneNode(!0);f.style.display="block",o.appendChild(f),await u();const m=this.getComputedWidth(o);if(o.removeChild(f),n+=(l>0?v:0)+m,s+n+w>=r)break;++l}return this.el.shadowRoot.removeChild(o),o.remove(),l}sortVisibleAndOverflowFilters(){this._sortedFilterEls={visible:this._filterEls.slice(0,this._filterCutoffIndex),overflow:this._filterEls.slice(this._filterCutoffIndex)},this._sortedFilterEls.visible.forEach(t=>{t.style.display&&t.style.removeProperty("display"),t.getAttribute("slot")!=="filters"&&t.setAttribute("slot","filters")}),this._sortedFilterEls.overflow.forEach(t=>{t.style.display!=="none"&&(t.style.display="none"),t.getAttribute("slot")!=="overflow-filters"&&t.setAttribute("slot","overflow-filters")})}async handleResize(){if(!this.getComputedWidth(this.el))return;const t=await this.findFilterCutoffIndex();if(t!==this._filterCutoffIndex&&(this._filterCutoffIndex=t,await u(),this.sortVisibleAndOverflowFilters(),this._dropdownMenuEl)){const i=this._dropdownMenuEl.querySelector(a("market-dropdown"));i!=null&&i.expanded&&(i==null||i.closeDropdown())}this.checkIfSearchShouldBeCompact()}async checkIfSearchShouldBeCompact(){var t,e;if(!this._slottedInputSearchEl||this._slottedInputSearchEl.hasAttribute("focused"))return;const i=(window==null?void 0:window.innerWidth)<=d.CORE_BREAKPOINT_NARROW_MAX_WIDTH,r=!!(!((t=this._filterEls)===null||t===void 0)&&t.length),s=this._filterEls.length>((e=this.maxVisibleFilters)!==null&&e!==void 0?e:p),o=r&&(i||s);o!==this._slottedInputSearchEl.hasAttribute("compact")&&(this._slottedInputSearchEl.getAttribute("focused")&&await this._slottedInputSearchEl.setFocus(!1),o?this._slottedInputSearchEl.setAttribute("compact",""):this._slottedInputSearchEl.removeAttribute("compact"))}handleInputSearchTabKeydown(t){var e;t.key==="Tab"&&!t.shiftKey&&(!((e=this._filterEls)===null||e===void 0)&&e.length)&&(t.preventDefault(),this._slottedInputSearchEl.blur(),this._willFocusOnFirstFilter=!0)}handleInputSearchFocus(){var t,e;const i=(e=(t=this._dropdownMenuEl)===null||t===void 0?void 0:t.shadowRoot)===null||e===void 0?void 0:e.querySelector(a("market-dropdown"));i!=null&&i.hasAttribute("expanded")&&i.closeDropdown()}registerSlottedInputSearch(){var t,e,i,r,s,o,l,n;(e=(t=this._slottedInputSearchEl)===null||t===void 0?void 0:t.removeEventListener)===null||e===void 0||e.call(t,"keydown",this.handleInputSearchTabKeydown),(r=(i=this._slottedInputSearchEl)===null||i===void 0?void 0:i.removeEventListener)===null||r===void 0||r.call(i,"focus",this.handleInputSearchFocus),this._slottedInputSearchEl=this.el.querySelector('[slot="search"]'),(o=(s=this._slottedInputSearchEl)===null||s===void 0?void 0:s.addEventListener)===null||o===void 0||o.call(s,"keydown",this.handleInputSearchTabKeydown.bind(this)),(n=(l=this._slottedInputSearchEl)===null||l===void 0?void 0:l.addEventListener)===null||n===void 0||n.call(l,"focus",this.handleInputSearchFocus.bind(this)),this.checkIfSearchShouldBeCompact()}registerSlottedFilters(){this._filterEls=[...this.el.querySelectorAll("market-filter")]}observeContent(t){this._observers.content||(this._observers.content=new ResizeObserver(this.throttledHandleResize),this._observers.content.observe(t))}connectedCallback(){this._observers.host||(this._observers.host=new ResizeObserver(this.throttledHandleResize),this._observers.host.observe(this.el))}componentWillLoad(){this.registerSlottedFilters(),this.registerSlottedInputSearch(),this.handleResize()}componentWillRender(){var t,e,i;this._willFocusOnFirstFilter&&((i=(e=(t=this._filterEls)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.setFocus)===null||i===void 0||i.call(e),this._willFocusOnFirstFilter=!1)}disconnectedCallback(){Object.entries(this._observers).forEach(([t,e])=>{e&&(e.disconnect(),this._observers[t]=void 0)})}render(){var t,e;const i=(e=(t=this._filterEls)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.size,r=a("market-filter-dropdown-menu");return h(E,{key:"9027c458d34aa4bfb3c3e7e3f1601d65f556b10e",class:"market-filter-group"},h("div",{key:"5cdcb45c3b78a2f770f5fdac24f76790b7458fd5",class:"content",ref:s=>this.observeContent(s)},h("slot",{key:"9e64fb4d6f4f7c4d3e1aec2c4c77843e4e9813f2",name:"search",onSlotchange:()=>this.registerSlottedInputSearch()}),h("slot",{key:"8945cc18f60441a9ba828b643d2339ade740bc1a",name:"filters",onSlotchange:()=>this.registerSlottedFilters()}),this._sortedFilterEls.overflow.length>0&&h(r,{key:"89f163b30392a2e031eb7102834ef34409c4456c",class:"dropdown-menu",size:i,ref:s=>this._dropdownMenuEl=s},h("slot",{key:"1562d8b18f467f9d12a277fe5893828c3af194a4",name:"overflow-filters",slot:"overflow-filters"}))))}get el(){return S(this)}static get watchers(){return{maxVisibleFilters:["maxVisibleFiltersWatcher"]}}};R.style=g;export{R as market_filter_group};
