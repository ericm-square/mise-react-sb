import{g as O}from"./max-z-index-7a974719-43GcVZqA.js";import{a as w}from"./raf-ac8923ee-Dje82vI4.js";import{g as E}from"./index-2dc281eb-DCayfYZh.js";async function L(o,t){const n=getComputedStyle(o),{transitionProperty:r}=n,e=r.split(", ");return Promise.all(Object.keys(t).map(a=>{const d=t[a];return new Promise(l=>{d||l(),d===o.style[a]&&l(),e.includes(a)||(o.style[a]=d,l());const h=i=>{i.propertyName===a&&(o.removeEventListener("transitionend",h),l())};o.addEventListener("transitionend",h),o.style[a]=d})}))}function x(o){const t=o==null?void 0:o.tagName.toLowerCase();return!!(o&&t===E("market-table-v2-row"))}function C(o){const t=o==null?void 0:o.tagName.toLowerCase();return!!(o&&t===E("market-table-v2-group"))}function Y(o){return!!(o&&o.dragEnabled!==void 0)}const W=Math.min(1e3/60),y=24,B=E("market-table-v2-group");class G{constructor(t,n){this.el=t,this.anchor=(n==null?void 0:n.anchor)||"none"}async start(t){this.canceled=!1;const{x:n,y:r}=t;this.startCoords=this.previousCoords=t;const{el:e,anchor:a}=this,d=C(e)?e.querySelector('[slot="parent"]'):e,{top:l,right:h,left:i,width:u,height:c}=v(d),m=e.parentElement,g=document.elementsFromPoint(n,r)[0],s=d.cloneNode(!0);if(s.classList.add("market-drag-clone","market-drag-transitioning"),!e.dispatchEvent(new CustomEvent("marketDragStart",{bubbles:!0,cancelable:!0,detail:Object.assign(Object.assign({},t),{el:e,source:m,target:g,clone:s})}))){this.canceled=!0;return}this.scrollParent=j(e),e.classList.add("market-drag-placeholder"),Object.assign(s.style,{position:"fixed",opacity:0,transitionProperty:"none"}),document.body.append(s),await w();const{width:p,height:f}=v(s);Object.assign(s.style,{opacity:"",width:`${u}px`,height:`${c}px`,top:`${l}px`,left:a!=="right"?`${i}px`:"auto",right:a!=="left"?`${window.innerWidth-h}px`:"auto",zIndex:`${O(document.body)+1}`}),await w(),s.style.transitionProperty="",x(s)&&s.querySelector("market-table-v2-cell").classList.add("market-drag-clone-first-cell"),s.style.setProperty("--market-drag-clone-shadow-opacity","1"),L(s,{top:`${l+(c-f)/2}px`,height:`${f}px`,width:a==="none"?`${u}px`:`${p}px`}).then(()=>{s.classList.remove("market-drag-transitioning")}),this.source=m,this.target=g,this.clone=s}move(t){const{el:n,clone:r,source:e,target:a,startCoords:d,previousCoords:l,canceled:h}=this,{x:i,y:u}=t;if(h||!r||i===l.x&&u===l.y)return;this.previousCoords=t;const c=[...document.elementsFromPoint(i,u)].find(s=>!r.contains(s));c!==a&&(a==null||a.dispatchEvent(new CustomEvent("marketDragLeave",{bubbles:!0,detail:{x:i,y:u,el:n,source:e,target:a,clone:r}})),c==null||c.dispatchEvent(new CustomEvent("marketDragEnter",{bubbles:!0,detail:{x:i,y:u,el:n,source:e,target:c,clone:r}})),this.target=c),c==null||c.dispatchEvent(new CustomEvent("marketDragMove",{bubbles:!0,detail:{x:i,y:u,el:n,source:e,target:c,clone:r}}));const m=i-d.x,g=u-d.y;Object.assign(r.style,{transform:`translate(${m}px, ${g}px)`}),this.scroll()}async end(t){if(this.canceled)return;const{el:n,source:r,clone:e,anchor:a,scrollInterval:d}=this,{x:l,y:h}=t;if(clearInterval(d),!e)return;const i=[...document.elementsFromPoint(l,h)].find(I=>!e.contains(I));!n.dispatchEvent(new CustomEvent("marketDragEnd",{bubbles:!0,cancelable:!0,detail:{x:l,y:h,el:n,source:r,target:i,clone:e}}))||i==null||i.dispatchEvent(new CustomEvent("marketDragDrop",{bubbles:!0,cancelable:!1,detail:{x:l,y:h,el:n,source:r,target:i,clone:e}}));const c=N(n,`${B}[collapsed]`),m=c&&c!==n,g=m?c.querySelector('[slot="parent"]'):C(n)?n.querySelector('[slot="parent"]'):n;await w();const{top:s,right:b,left:p,width:f,height:$}=v(g),{top:M,right:T,left:S,width:D,height:R}=v(e),k=a==="left"?S-p:T-b,P=M-s;Object.assign(e.style,{pointerEvents:"none",transitionProperty:"none",top:`${s}px`,left:a!=="right"?`${p}px`:"auto",right:a!=="left"?`${window.innerWidth-b}px`:"auto",width:`${D}px`,height:`${R}px`,transform:`translate(${k}px, ${P}px)`}),await w(),e.style.transitionProperty="",x(e)&&x(g)&&e.querySelector("market-table-v2-cell").classList.remove("market-drag-clone-first-cell"),e.classList.add("market-drag-released","market-drag-transitioning"),m&&e.classList.add("market-drag-into-collapsed-group"),e.style.removeProperty("--market-drag-clone-shadow-opacity"),await L(e,{width:`${f}px`,height:`${$}px`,transform:k||P?"translate(0, 0)":null}),n.classList.remove("market-drag-placeholder"),e.remove(),n==null||n.dispatchEvent(new CustomEvent("marketDragComplete",{bubbles:!0,cancelable:!1,detail:{x:l,y:h,el:n,source:r,target:i,clone:e}}))}scroll(){const{clone:t,scrollParent:n,scrollInterval:r}=this;clearInterval(r);const{bottom:e,top:a,right:d,left:l}=v(t),{bottom:h,top:i,right:u,left:c}=H(n),m=e-h,g=a-i,s=m>0?Math.min(m/4,y):g<0?Math.max(g/4,-y):0,b=d-u,p=l-c,f=b>0?Math.min(b/4,y):p<0?Math.max(p/4,-y):0;(s!==0||f!==0)&&(this.scrollInterval=setInterval(()=>{n.scrollBy({top:s,left:f})},W))}destroy(){this.el=null,this.clone=null,this.source=null,this.target=null,this.startCoords=null,this.canceled=null,this.scrollParent=null,this.scrollInterval=null,this.anchor=null}}function j(o){let t=o.parentElement;for(;t!==document.documentElement;){const{overflowY:n,overflowX:r}=getComputedStyle(t),e=/(auto|scroll)/.test(n)&&t.scrollHeight>t.offsetHeight,a=/(auto|scroll)/.test(r)&&t.scrollWidth>t.offsetWidth;if(e||a)return t;t=t.parentElement}return document.documentElement}function H(o){const{top:t,right:n,bottom:r,left:e}=v(o);if(o===document.documentElement){const d=window.innerWidth,l=window.innerHeight;return{top:0,right:d,bottom:l,left:0}}return{top:t,right:n,bottom:r,left:e}}function N(o,t){let n,r=o;for(;r!==document.body;){const e=r.closest(t);e&&(n=e),r=r.parentElement}return n}function v(o){const t=o.getBoundingClientRect();return{top:Math.round(t.top),right:Math.round(t.right),bottom:Math.round(t.bottom),left:Math.round(t.left),width:Math.round(t.width),height:Math.round(t.height)}}export{G as D,C as a,x as b,Y as i};
