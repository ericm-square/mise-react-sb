import{r as o,c as s,h as a,H as c,g as l}from"./preview-BLkU8-7b.js";import{g as r}from"./index-2dc281eb-DCayfYZh.js";import{a as h}from"./raf-ac8923ee-Dje82vI4.js";import"./jsx-runtime-qGIIFXMu.js";import"./index-CDs2tPxN.js";import"./iframe-BYgjunmg.js";import"../sb-preview/runtime.js";import"./tslib.es6-pJfR_DrR.js";const d=":host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}:host{position:fixed;top:0;left:0;z-index:-1000;display:block;overflow:hidden;width:100vw;height:100%;opacity:0%}:host([active]){z-index:1000;opacity:100%;pointer-events:none}",m=d,v=class{constructor(t){o(this,t),this.marketContextManagerActivated=s(this,"marketContextManagerActivated",7),this.marketContextManagerDeactivated=s(this,"marketContextManagerDeactivated",7),this.active=!1,this.currentContext=void 0,this.stack=[]}initChildListObserver(){if(this.childListObserver)return;const t=()=>{this.stack=[...this.el.children],this.currentContext=this.stack.length>0?this.stack[this.stack.length-1]:null};t(),this.childListObserver=new MutationObserver(t),this.childListObserver.observe(this.el,{childList:!0})}async getCurrentContext(){for(;!this.currentContext;)await h();return this.currentContext}contextEmptiedEventHandler({target:t}){t.remove(),this.stack.splice(this.stack.indexOf(t),1),this.stack.length===0&&this.deactivate()}windowKeydown(t){var e;(t.key==="Escape"||t.key==="Esc")&&((e=this.currentContext)===null||e===void 0||e.currentDialog.el.dismiss({origin:this.el}))}async open(t,e){let i=e;(!this.currentContext||t)&&(i=!0),i&&this.createNewContext(),await this.currentContext.open(t)}close(t){return this.currentContext.close(t),Promise.resolve()}createNewContext(){return this.activate(),this.el.appendChild(document.createElement(r("market-context"))),this.currentContext=this.el.lastElementChild,Promise.resolve()}deactivate(){return this.active=!1,this.marketContextManagerDeactivated.emit(),Promise.resolve()}activate(){return this.active||(this.active=!0,this.marketContextManagerActivated.emit()),Promise.resolve()}handleMouseEvents(t){var e,i;if(t.type==="mousedown")this.mouseDownEl=t.target.tagName;else if(t.type==="mouseup"){const n=t.target.tagName;this.mouseDownEl===n&&t.target.tagName.toLowerCase()===r("market-context")&&!t.target.classList.contains("no-veil")&&((i=(e=this.currentContext)===null||e===void 0?void 0:e.currentDialog)===null||i===void 0||i.el.dismiss({origin:this.el}))}}componentDidLoad(){this.initChildListObserver()}render(){return a(c,{key:"72a7dfd3862281d08036a4d1af846b8203e73893",class:"market-context-manager",onMouseDown:t=>this.handleMouseEvents(t),onMouseUp:t=>this.handleMouseEvents(t)},a("slot",{key:"b7ef4e0031991376e48a559f2a026174667ff429"}))}disconnectedCallback(){var t;(t=this.childListObserver)===null||t===void 0||t.disconnect()}get el(){return l(this)}};v.style=m;export{v as market_context_manager};
