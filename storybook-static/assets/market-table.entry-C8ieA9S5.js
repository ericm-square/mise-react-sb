import{r as p,h as o,H as f,g as k}from"./preview-BLkU8-7b.js";import{g as u}from"./index-2dc281eb-DCayfYZh.js";import{t as w}from"./throttle-552e88ff-BILzQ6sF.js";import{b as y}from"./_baseIsEqual-efa577aa-BqZvovRz.js";import"./isObject-f305a0d7-CA5ssx5i.js";import"./_arrayPush-074dda83-BicVvr-I.js";import"./_getNative-e422aac7-CFRFUET7.js";import"./_Map-5d7abd2f-CY00VWNU.js";import"./_getTag-40eee50c-43w3foRc.js";import"./jsx-runtime-qGIIFXMu.js";import"./index-CDs2tPxN.js";import"./iframe-BYgjunmg.js";import"../sb-preview/runtime.js";import"./tslib.es6-pJfR_DrR.js";import"./isSymbol-385885b1-CYoGKoqs.js";function g(t,e){return y(t,e)}const C=t=>{const e=t.split(" "),s=["auto-fill","auto-fit","minmax","fit-content"].filter(r=>t.includes(r)),m=`${s.length>0?"features":"feature"} ${s.map(r=>`\`${r}\``).join(", ")}`;if(s.length>0)return console.warn(`<market-table>'s grid layout is not built to support the use of the CSS ${m}.
To avoid potential column layout issues, try using explicitly defined \`grid-template-column\` widths using length, percentage, or flex units.`),e;const c=[];let l=0,n=null;for(l=0;l<e.length;l++){const r=e[l];if(r.includes("repeat(")){n=Number.parseInt(r.match(/\d+/).toString(),10);const d=e.findIndex((a,b)=>b>l&&a.includes(")")),h=e.slice(l+1,d+1).map(a=>a.replace(/\W/,""));for(let a=0;a<n;a++)c.push(h[a%h.length].toString());n=null,l+=h.length}else n||c.push(r)}return c},v=':host{position:relative;display:grid;grid-auto-columns:1fr;grid-auto-flow:rows;overflow-x:clip;height:auto}::slotted(.market-table-row:last-of-type:not([slot="header"])),::slotted(.market-table-row.buffer-row){border-bottom:none !important;}',S=v,T=16,R=class{constructor(t){p(this,t),this.observers={},this.throttledDetectStyleDeclaration=w(this.detectStyleDeclaration.bind(this),T),this.styleDeclaration=void 0,this.gridColumnTemplate=void 0,this.allColumns=[],this.visibleColumns=[],this.columnsStuckLeft=[],this.columnsStuckRight=[],this.columnsUnstuck=[],this.allRows=[],this.rowsStuckTop=[],this.rowsStuckBottom=[],this.rowsUnstuck=[],this.hasAccordionRows=!1}styleDeclarationObserver(t,e){if(t!==e){if(t.getPropertyValue("grid-template-columns")===t.getPropertyValue("width")){this.gridColumnTemplate=[];return}const i=C(t.getPropertyValue("grid-template-columns"));g(i,this.gridColumnTemplate)||(this.gridColumnTemplate=i)}}gridTemplateObserver(t,e){t!==e&&(this.setColumnWidths(t),this.updateGridLayout())}allColumnsObserver(t,e){t&&(!e||t!==e)&&(this.setColumnWidths(this.gridColumnTemplate),this.forwardColumnPropertiesToCells(this.allColumns),this.updateGridLayout())}allRowsObserver(t,e){t!==e&&t&&(this.updateGridLayout(),this.forwardColumnPropertiesToCells(this.allColumns),this.updateStickyRows())}stuckRowsObserver(t,e){t!==e&&(this.allRows.map(i=>i.classList.remove("buffer-row")),this.rowsStuckTop.length>0&&this.rowsStuckTop[this.rowsStuckTop.length-1].classList.add("buffer-row"),this.rowsUnstuck.length>0&&this.rowsStuckBottom.length>0&&this.rowsUnstuck[this.rowsUnstuck.length-1].classList.add("buffer-row"))}marketTableHeaderLoadedEventHandler({detail:t}){this.allColumns=[...t.columns],this.checkColumnVisibility()}marketTableRowStickEventHandler({target:t,detail:e}){switch(e.position){case"top":t.slot="sticky-header";break;case"bottom":t.slot="sticky-footer";break;default:console.warn("could not stick row to an unknown position");break}this.updateStickyRows()}marketTableRowUnstickEventHandler({target:t}){t.originalSlot?t.slot=t.originalSlot:t.removeAttribute("slot"),this.updateStickyRows()}async marketTableColumnStickEventHandler({target:t,detail:e}){await Promise.all([...this.allRows].map(async i=>{await i._stickColumn(t.name,e.position)})),this.updateGridLayout()}async marketTableColumnUnstickEventHandler({target:t}){await Promise.all([...this.allRows].map(async e=>{await e._unstickColumn(t.name)})),this.updateGridLayout()}marketTableColumnVisibilityChangeHandler({detail:t}){this.checkColumnVisibility(),this.allRows.forEach(e=>e._syncColumnVisibilityWithCells(t.columnName,t.hidden)),this.detectStyleDeclaration()}checkColumnVisibility(){this.visibleColumns=this.allColumns.filter(t=>!t.hidden)}setColumnWidths(t){this.allColumns.length>0&&this.visibleColumns.forEach((e,i)=>{e.width=t[i]})}forwardColumnPropertiesToCells(t){this.allRows.forEach(e=>e.tableColumns=t)}updateGridLayout(){if(this.allColumns.length>0){this.columnsUnstuck=this.visibleColumns.filter(s=>!s.stickTo),this.columnsStuckLeft=this.visibleColumns.filter(s=>s.stickTo==="left"),this.columnsStuckRight=this.visibleColumns.filter(s=>s.stickTo==="right");const t=this.columnsUnstuck.map(s=>s.width),e=this.columnsStuckLeft.map(s=>s.width),i=this.columnsStuckRight.map(s=>s.width);this.allRows.length>0&&this.allRows.forEach(s=>{s.gridTemplateMain=t,s.gridTemplateLeft=e,s.gridTemplateRight=i})}}updateStickyRows(){this.rowsStuckTop=this.allRows.filter(t=>t.sticky&&t.header||t.stickTo==="top"),this.rowsStuckBottom=this.allRows.filter(t=>t.sticky&&t.footer||t.stickTo==="bottom"),this.rowsUnstuck=this.allRows.filter(t=>!t.stickTo&&!t.sticky)}handleSlotChange(){this.allRows=[...this.el.querySelectorAll(u("market-table-row"))];const t=[...this.el.children].some(e=>e.tagName.toLowerCase()===u("market-accordion-item"))||this.hasAccordionRows;this.allRows.forEach(e=>{e.index=Array.prototype.indexOf.call(this.allRows,e),e.nested=t})}detectStyleDeclaration(){this.styleDeclaration=window.getComputedStyle(this.el)}initResizeObserver(){this.observers.resize||(this.observers.resize=new ResizeObserver(()=>{window.requestAnimationFrame(()=>{this.throttledDetectStyleDeclaration()})}),this.observers.resize.observe(this.el))}initInlineStyleObserver(){this.observers.inlineStyle||(this.observers.inlineStyle=new MutationObserver(()=>this.detectStyleDeclaration()),this.observers.inlineStyle.observe(this.el,{attributes:!0,attributeFilter:["style"]}))}initContentObserver(){this.observers.content||(this.observers.content=new MutationObserver(()=>this.handleSlotChange()),this.observers.content.observe(this.el,{childList:!0,subtree:!0,characterData:!0}))}componentWillLoad(){this.detectStyleDeclaration(),this.handleSlotChange()}componentDidLoad(){this.initResizeObserver(),this.initInlineStyleObserver(),this.initContentObserver()}render(){const t=u("market-table-area");return o(f,{key:"deff888b975bcde738402892ebc337b3e3bbd7ef",class:"market-table",role:"table",onSlotchange:()=>this.handleSlotChange()},o(t,{key:"a84e86f14293bb5b543c2a8533b893339bb2b8c7",orientation:"horizontal","stick-to":"top",active:this.rowsStuckTop.length>0},o("slot",{key:"3498724f5d8daae5324429e97a03f105d84bd833",name:"sticky-header"})),o(t,{key:"5e00b8c2703a4325e6e3cc7e430aee1aa8528e43",orientation:"horizontal",active:!0},o("slot",{key:"f7e9a53da97dc7ff537393fb155e3a9b34ccec6a",name:"header"}),o("slot",{key:"9eac3ccb2b3901f32a118140172b38a2b82b0121"}),o("slot",{key:"a0b121517dbe2010c56485f42fc22e23a9ad86c3",name:"footer"})),o(t,{key:"738616882627afc59488f2e5403eb4712fa961cb",orientation:"horizontal","stick-to":"bottom",active:this.rowsStuckBottom.length>0},o("slot",{key:"083949c01198bea7348f7a9b3a6fbff4dcb663d7",name:"sticky-footer"})))}disconnectedCallback(){Object.values(this.observers).forEach(t=>{t==null||t.disconnect()})}get el(){return k(this)}static get watchers(){return{styleDeclaration:["styleDeclarationObserver"],gridColumnTemplate:["gridTemplateObserver"],allColumns:["allColumnsObserver"],visibleColumns:["allColumnsObserver"],allRows:["allRowsObserver"],rowsStuckTop:["stuckRowsObserver"],rowsStuckBottom:["stuckRowsObserver"],rowsUnstuck:["stuckRowsObserver"]}}};R.style=S;export{R as market_table};
